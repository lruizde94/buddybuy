<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BuddyBuy - Explorador de Productos</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- User Bar -->
    <div class="user-bar" id="userBar">
        <div class="container">
            <div class="user-bar-content">
                <div class="user-info" id="userInfo" style="display: none;">
                    <span>üë§</span>
                    <span id="currentUserName"></span>
                    <button class="btn-profile" onclick="showProfileModal()">Mi Perfil</button>
                    <button class="btn-logout" onclick="logoutUser()">Salir</button>
                </div>
                <div class="login-prompt" id="loginPrompt">
                    <span>Inicia sesi√≥n para guardar tus favoritos</span>
                    <button class="btn-login" onclick="showLoginModal()">Entrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1>BuddyBuy</h1>
                </div>
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="Buscar productos..." class="search-input">
                    <button class="search-btn" id="searchBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.3-4.3"></path>
                        </svg>
                    </button>
                </div>
                <button class="menu-toggle" id="menuToggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <div class="layout">
                <!-- Sidebar - Categor√≠as -->
                <aside class="sidebar" id="sidebar">
                    <div class="sidebar-header">
                        <h2>Categor√≠as</h2>
                        <button class="close-sidebar" id="closeSidebar">√ó</button>
                    </div>
                    <nav class="categories-nav" id="categoriesNav">
                        <div class="loading-categories">
                            <div class="spinner"></div>
                            <p>Cargando categor√≠as...</p>
                        </div>
                    </nav>
                </aside>

                <!-- Products Grid -->
                <section class="products-section">
                    <div class="products-header">
                        <h2 id="categoryTitle">Selecciona una categor√≠a</h2>
                        <div class="products-info">
                            <span id="productsCount">0 productos</span>
                            <select id="sortSelect" class="sort-select">
                                <option value="name">Ordenar por nombre</option>
                                <option value="price-asc">Precio: menor a mayor</option>
                                <option value="price-desc">Precio: mayor a menor</option>
                            </select>
                        </div>
                    </div>
                    <div class="products-grid" id="productsGrid">
                        <div class="welcome-message">
                    
                            <h3>¬°Bienvenido al explorador de productos!</h3>
                            <p>Selecciona una categor√≠a del men√∫ lateral para ver los productos disponibles o utiliza el buscador.</p>
                        </div>
                    </div>
                    <div class="loading-products hidden" id="loadingProducts">
                        <div class="spinner"></div>
                        <p>Cargando productos...</p>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Ingredients Panel (floating) -->
    <div class="ingredients-panel" id="ingredientsPanel">
        <div class="ingredients-header" role="button" aria-expanded="false">
                <h3>ü•ó Mis Ingredientes</h3>
                <div class="ingredients-collapsed-icons" id="ingredientsCollapsedIcons" aria-hidden="true"></div>
                <span class="ingredients-count" id="ingredientsCount">0</span>
            </div>
        <div class="ingredients-list" id="ingredientsList">
            <p class="empty-ingredients">Haz clic en "+ A√±adir" en los productos para agregar ingredientes</p>
        </div>
        <div class="ingredients-actions">
            <button class="btn-clear" id="clearIngredients">Limpiar</button>
            <button class="btn-generate" id="generateMenu">‚ú® Generar Men√∫</button>
        </div>
    </div>

    <!-- Toggle Ingredients Panel Button -->
    <!-- Floating Controls (centered group) -->
    <div id="floatingControls">
        <!-- Toggle Ingredients Panel Button -->
        <button class="ingredients-toggle" id="ingredientsToggle">
            <span>ü•ó</span>
            <span class="toggle-count" id="toggleCount">0</span>
        </button>

        <!-- Favorites Button -->
        <button class="favorites-toggle" id="favoritesToggle" onclick="showFavoritesModal()">
            <span>‚≠ê</span>
            <span class="favorites-count" id="favoritesCount" style="display: none;">0</span>
        </button>

        <!-- User Favorites Button -->
        <button class="user-favorites-toggle" id="userFavoritesToggle" onclick="showUserFavoritesCategory()" style="display: none;">
            <span>‚ù§Ô∏è</span>
            <span class="user-favorites-count" id="userFavoritesCount" style="display: none;">0</span>
        </button>
    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content modal-small">
            <button class="modal-close" onclick="closeLoginModal()">√ó</button>
            <div class="modal-body">
                <div class="login-header">
                    <h2>üë§ Iniciar Sesi√≥n</h2>
                    <p>Ingresa para guardar tus productos favoritos</p>
                </div>
                <div class="login-form">
                    <!-- Google OAuth Button -->
                    <button class="btn-google-login" onclick="loginWithGoogle()">
                        <svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.64 9.2c0-.63-.06-1.25-.16-1.84H9v3.49h4.84c-.21 1.13-.86 2.08-1.83 2.72v2.26h2.97c1.73-1.6 2.73-3.95 2.73-6.63z" fill="#4285F4"/>
                            <path d="M9 18c2.48 0 4.56-.82 6.08-2.23l-2.97-2.26c-.82.55-1.87.87-3.11.87-2.39 0-4.41-1.62-5.13-3.79H.85v2.33A8.997 8.997 0 009 18z" fill="#34A853"/>
                            <path d="M3.87 10.59c-.19-.55-.29-1.14-.29-1.74s.1-1.19.29-1.74V4.78H.85A8.997 8.997 0 000 9c0 1.45.35 2.82.85 4.04l3.02-2.45z" fill="#FBBC05"/>
                            <path d="M9 3.58c1.35 0 2.56.46 3.51 1.37l2.63-2.63C13.56.89 11.48 0 9 0 5.48 0 2.44 2.02.85 4.96l3.02 2.45c.72-2.17 2.74-3.83 5.13-3.83z" fill="#EA4335"/>
                        </svg>
                        Continuar con Google
                    </button>
                    
                    <div class="login-divider"><span>o usa login de prueba</span></div>
                    
                    <div class="existing-users" id="existingUsers" style="display: none;">
                        <label>Usuarios de prueba:</label>
                        <div class="users-list" id="usersList"></div>
                    </div>
                    <input type="text" id="usernameInput" placeholder="Nombre de prueba..." class="login-input">
                    <button class="btn-login-submit btn-test-login" onclick="loginUser()">Entrar (prueba)</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ticket Upload Button -->
    <button class="ticket-toggle" id="ticketToggle" onclick="showTicketModal()">
        <span>üßæ</span>
    </button>

    <!-- Shopping List Button -->
        <!-- Ticket Upload Button -->
        <button class="ticket-toggle" id="ticketToggle" onclick="showTicketModal()">
            <span>üßæ</span>
        </button>

        <!-- Shopping List Button -->
        <button class="shopping-list-toggle" id="shoppingListToggle" onclick="showShoppingListModal()">
            <span>üìã</span>
            <span class="shopping-list-count" id="shoppingListCount" style="display: none;">0</span>
        </button>
    </div>

    <!-- Shopping List Modal -->
    <div class="modal" id="shoppingListModal">
        <div class="modal-content modal-large">
            <button class="modal-close" onclick="closeShoppingListModal()">√ó</button>
            <div class="modal-body">
                <div class="shopping-list-header">
                    <h2>üìã Mi Lista de la Compra</h2>
                    <p id="shoppingListSubtitle">A√±ade productos y comparte tu lista</p>
                </div>
                
                <!-- Shared Lists Notification -->
                <div class="shared-lists-section" id="sharedListsSection" style="display: none;">
                    <h4>üì® Listas compartidas contigo</h4>
                    <div class="shared-lists-container" id="sharedListsContainer"></div>
                </div>
                
                <!-- Normal mode: search -->
                <div class="shopping-list-search" id="shoppingListSearchSection">
                    <input type="text" id="shoppingListSearch" placeholder="Buscar productos para a√±adir..." class="shopping-search-input">
                    <div class="shopping-search-results" id="shoppingSearchResults"></div>
                </div>
                <div class="shopping-list-content" id="shoppingListContent">
                    <div class="empty-shopping-list">
                        <span>üõí</span>
                        <p>Tu lista est√° vac√≠a</p>
                        <small>Busca productos arriba para a√±adirlos</small>
                    </div>
                </div>
                <div class="shopping-list-footer">
                    <div class="shopping-list-total">
                        <span>Total aproximado:</span>
                        <span class="total-amount" id="shoppingListTotal">0,00 ‚Ç¨</span>
                        <small id="shoppingListNote">(algunos productos son al peso)</small>
                    </div>
                    <div class="shopping-list-actions" id="shoppingListActions">
                        <button class="btn-clear-list" onclick="clearShoppingList()">üóëÔ∏è Vaciar</button>
                        <button class="btn-frecuentes" id="frecuentesBtn" style="display:none;" onclick="applyFrecuentes()">‚≠ê Frecuentes</button>
                        <button class="btn-go-shopping" onclick="startShoppingMode()">üõí Voy a Comprar</button>
                        <button class="btn-share-list" onclick="showShareOptions()">üîó Compartir</button>
                    </div>
                    <!-- Shopping mode actions (hidden by default) -->
                    <div class="shopping-mode-actions" id="shoppingModeActions" style="display: none;">
                        <button class="btn-exit-shopping" onclick="exitShoppingMode()">‚úì Terminar Compra</button>
                    </div>
                    <!-- Share options -->
                    <div class="share-options" id="shareOptions" style="display: none;">
                        <div class="share-option-row">
                            <button class="btn-share-link" onclick="shareShoppingList()">üîó Copiar enlace</button>
                            <div class="share-to-user">
                                <input type="text" id="shareToUserInput" placeholder="Nombre de usuario...">
                                <button onclick="shareToUser()">Enviar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ticket Upload Modal -->
    <div class="modal" id="ticketModal">
        <div class="modal-content modal-medium">
            <button class="modal-close" onclick="closeTicketModal()">√ó</button>
            <div class="modal-body">
                <div class="ticket-header">
                    <h2>üßæ Subir Ticket de Compra</h2>
                    <p>Sube tu ticket en PDF y elige qu√© quieres hacer</p>
                </div>
                <div class="ticket-upload-area" id="ticketUploadArea">
                    <div class="upload-icon">üìÑ</div>
                    <p>Arrastra tu ticket aqu√≠ o haz clic para seleccionar</p>
                    <input type="file" id="ticketFileInput" accept=".pdf" hidden>
                    <button class="btn-select-file" onclick="document.getElementById('ticketFileInput').click()">
                        Seleccionar PDF
                    </button>
                </div>
                <div class="ticket-file-info hidden" id="ticketFileInfo">
                    <span class="file-icon">üìÑ</span>
                    <span class="file-name" id="ticketFileName"></span>
                    <button class="btn-remove-file" onclick="removeTicketFile()">√ó</button>
                </div>
                <div class="ticket-options">
                    <h4>¬øQu√© quieres hacer?</h4>
                    <div class="option-buttons">
                        <button class="btn-option selected" id="btnFindProducts">
                            <span>‚ù§Ô∏è</span>
                            <span>Buscar Productos</span>
                            <small>A√±adir a favoritos</small>
                        </button>
                    </div>
                    <p class="note" style="margin-top:8px; color: var(--text-muted); font-size:0.9rem;">La generaci√≥n de recetas y men√∫s se realiza desde la secci√≥n <strong>Generar recetas</strong> usando tus ingredientes seleccionados.</p>
                </div>
                <button class="btn-process-ticket" id="processTicketBtn" onclick="processTicket()" disabled>
                    ‚ú® Procesar Ticket
                </button>
            </div>
        </div>
    </div>

    <!-- Favorites Modal -->
    <div class="modal" id="favoritesModal">
        <div class="modal-content modal-large">
            <button class="modal-close" onclick="closeFavoritesModal()">√ó</button>
            <div class="modal-body">
                <div class="favorites-header">
                    <h2>‚≠ê Mis Men√∫s Favoritos</h2>
                    <p>Tus men√∫s guardados para acceso r√°pido</p>
                </div>
                <div class="favorites-content" id="favoritesContent">
                    <!-- Favorites will be rendered here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal" id="profileModal">
        <div class="modal-content modal-xlarge">
            <button class="modal-close" onclick="closeProfileModal()">√ó</button>
            <div class="modal-body">
                <div class="profile-header">
                    <h2>üë§ Mi Perfil</h2>
                    <p id="profileUserName"></p>
                </div>
                
                <!-- Profile Tabs -->
                <div class="profile-tabs">
                    <button class="profile-tab active" onclick="switchProfileTab('tickets')" id="tabTickets">üßæ Mis Tickets</button>
                    <button class="profile-tab" onclick="switchProfileTab('stats')" id="tabStats">üìä Estad√≠sticas</button>
                </div>
                
                <!-- Tickets Tab Content -->
                <div class="profile-tab-content" id="ticketsTabContent">
                    <div class="tickets-list" id="ticketsList">
                        <div class="empty-tickets">
                            <span>üßæ</span>
                            <p>No tienes tickets guardados</p>
                            <small>Sube un ticket de compra y se guardar√° autom√°ticamente aqu√≠</small>
                        </div>
                    </div>
                </div>
                
                <!-- Stats Tab Content -->
                <div class="profile-tab-content hidden" id="statsTabContent">
                    <div class="stats-filters">
                        <label>Filtrar por fecha:</label>
                        <div class="date-range-picker">
                            <input type="date" id="statsStartDate" onchange="loadUserStats()">
                            <span>a</span>
                            <input type="date" id="statsEndDate" onchange="loadUserStats()">
                            <button class="btn-clear-dates" onclick="clearDateFilters()">Limpiar</button>
                        </div>
                        <div class="quick-date-filters">
                            <button onclick="setQuickDateFilter('week')">√öltima semana</button>
                            <button onclick="setQuickDateFilter('month')">√öltimo mes</button>
                            <button onclick="setQuickDateFilter('3months')">3 meses</button>
                            <button onclick="setQuickDateFilter('year')">Este a√±o</button>
                            <button onclick="setQuickDateFilter('all')">Todo</button>
                        </div>
                    </div>
                    
                    <div class="stats-dashboard" id="statsDashboard">
                        <div class="stats-summary">
                            <div class="stat-card">
                                <span class="stat-icon">üßæ</span>
                                <div class="stat-info">
                                    <span class="stat-value" id="statTotalTickets">0</span>
                                    <span class="stat-label">Tickets</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <span class="stat-icon">üí∞</span>
                                <div class="stat-info">
                                    <span class="stat-value" id="statTotalSpent">0,00 ‚Ç¨</span>
                                    <span class="stat-label">Gasto Total</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <span class="stat-icon">üìä</span>
                                <div class="stat-info">
                                    <span class="stat-value" id="statAvgTicket">0,00 ‚Ç¨</span>
                                    <span class="stat-label">Media por Ticket</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stats-charts">
                            <div class="chart-container">
                                <h4>üìÅ Gasto por Categor√≠a</h4>
                                <div class="category-chart" id="categoryChart">
                                    <p class="no-data">No hay datos disponibles</p>
                                </div>
                            </div>
                            
                            <div class="chart-container">
                                <h4>‚≠ê Productos m√°s comprados</h4>
                                <div class="top-products-list" id="topProductsList">
                                    <p class="no-data">No hay datos disponibles</p>
                                </div>
                            </div>
                            
                            <div class="chart-container full-width">
                                <h4>üìà Gasto Mensual</h4>
                                <div class="monthly-chart" id="monthlyChart">
                                    <p class="no-data">No hay datos disponibles</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">√ó</button>
            <div class="modal-body" id="modalBody">
                <!-- Product details will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Menu Modal -->
    <div class="modal" id="menuModal">
        <div class="modal-content modal-large">
            <button class="modal-close" id="menuModalClose">√ó</button>
            <div class="modal-body" id="menuModalBody">
                <div class="menu-loading" id="menuLoading">
                    <div class="spinner"></div>
                    <p>Generando recetas personalizadas...</p>
                </div>
                <div class="menu-content" id="menuContent"></div>
            </div>
        </div>
    </div>

    <!-- Overlay for mobile sidebar -->
    <div class="overlay" id="overlay"></div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
        </div>
    </footer>

    <script src="app.js"></script>
</body>
</html>
